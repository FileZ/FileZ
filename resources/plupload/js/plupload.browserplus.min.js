(function(a){var b=true,c=false;a.runtimes.BrowserPlus=a.addRuntime("browserplus",{init:function(i,k){var g=window.BrowserPlus,j={},f=i.settings,e=f.resize;function h(p){var o,n,l=[],m,q;for(n=0;n<p.length;n++){m=p[n];q=a.guid();j[q]=m;l.push(new a.File(q,m.name,m.size))}if(n){i.trigger("FilesAdded",l)}}if(g){g.init(function(m){var l=[{service:"Uploader",version:"3"},{service:"DragAndDrop",version:"1"},{service:"FileBrowse",version:"1"}];if(e){l.push({service:"ImageAlter",version:"4"})}if(m.success){g.require({services:l},function(){if(m.success){d()}else{k()}})}else{k()}})}else{k()}function d(){i.bind("PostInit",function(){var o,m=f.drop_element,q=i.id+"_droptarget",l=document.getElementById(m),n;if(l){function r(t,s){g.DragAndDrop.AddDropTarget({id:t},function(u){g.DragAndDrop.AttachCallbacks({id:t,hover:function(v){if(!v&&s){s()}},drop:function(v){if(s){s()}h(v)}},function(){})})}if(document.attachEvent&&(/MSIE/gi).test(navigator.userAgent)){o=document.createElement("div");o.setAttribute("id",q);a.extend(o.style,{position:"absolute",top:"-1000px",background:"red",filter:"alpha(opacity=0)",opacity:0});document.body.appendChild(o);a.addEvent(l,"dragenter",function(t){var s,u;s=document.getElementById(m);u=a.getPos(s);a.extend(document.getElementById(q).style,{top:u.y+"px",left:u.x+"px",width:s.offsetWidth+"px",height:s.offsetHeight+"px"})});function p(){document.getElementById(q).style.top="-1000px"}r(q,p)}else{r(m)}}a.addEvent(document.getElementById(f.browse_button),"click",function(x){var v=[],t,s,w=f.filters,u;x.preventDefault();for(t=0;t<w.length;t++){u=w[t].extensions.split(",");for(s=0;s<u.length;s++){v.push(a.mimeTypes[u[s]])}}g.FileBrowse.OpenBrowseDialog({mimeTypes:v},function(y){if(y.success){h(y.value)}})});l=dropTarget=0});i.bind("UploadFile",function(l,n){var m=l.settings.url,p=j[n.id];function o(q){n.size=q.size;g.Uploader.upload({url:m+(m.indexOf("?")==-1?"?":"&")+"&multipart=true&name="+escape(n.target_name||n.name),files:{file:q},cookies:document.cookies,progressCallback:function(r){n.loaded=r.fileSent;l.trigger("UploadProgress",n)}},function(r){if(r.success){n.status=a.DONE;l.trigger("FileUploaded",n,{response:r.value.body,status:r.value.statusCode})}})}if(e&&/\.(png|jpg|jpeg)$/i.test(n.name)){BrowserPlus.ImageAlter.transform({file:p,quality:e.quality||90,actions:[{scale:{maxwidth:e.width,maxheight:e.height}}]},function(q){if(q.success){o(q.value.file)}})}else{o(p)}});i.features={dragdrop:b,jpgresize:b,pngresize:b,chunks:c};k({success:b})}}})})(plupload);